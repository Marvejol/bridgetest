<!DOCTYPE html>
        <html lang="en">
        <head>
            <title>Fetching & Copying...</title>
            <style>
                body { 
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
                    text-align: center; 
                    padding: 20px; 
                    margin: 0;
                    background-color: #f0f4f8; 
                    transition: background-color 0.5s;
                    color: #333;
                }
                .message { font-size: 18px; font-weight: bold; }
                .success { color: #28a745; }
                .error { color: #dc3545; }
            </style>
        </head>
        <body>
            <div id="status" class="message">Fetching API data...</div>
            <script>
                // This script runs inside the popup with default, permissive permissions
                const statusEl = document.getElementById('status');

                // 1. Fetch data from a reliable public API
                fetch('https://jsonplaceholder.typicode.com/posts/1')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('API request failed. Status: ' + response.status);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Popup: API data received successfully.');
                        statusEl.textContent = 'Copying to clipboard...';
                        
                        // 2. Format the JSON object into a readable string
                        const textToCopy = JSON.stringify(data, null, 2);

                        // 3. Write the formatted string to the clipboard
                        return navigator.clipboard.writeText(textToCopy);
                    })
                    .then(() => {
                        console.log('Popup: API data copied to clipboard!');
                        statusEl.textContent = 'Success! API Data Copied.';
                        statusEl.classList.add('success');
                        document.body.style.backgroundColor = '#e9f7ef';
                    })
                    .catch(err => {
                        console.error('Popup Script Error:', err);
                        statusEl.textContent = 'Error: Could not fetch or copy.';
                        statusEl.classList.add('error');
                        document.body.style.backgroundColor = '#fbe9e7';
                    })
                    .finally(() => {
                        // Close the popup after a delay to show the message
                        setTimeout(() => window.close(), 4000);
                    });
            <\/script>
        </body>
        </html>
